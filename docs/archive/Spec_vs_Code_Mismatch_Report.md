# Spec vs Code Mismatch Report

All findings compare the previous “Comprehensive FastAPI Endpoint Reference v2.0” to the actual implementation under `vanna-engine/app`. The FastAPI source is the source of truth, so every fix recommendation is to update the documentation unless otherwise noted.

| # | Documentation Claim | Actual Code Behavior | Correct Source | Fix |
| --- | --- | --- | --- | --- |
| 1 | Auth endpoints accept `email/password` and return `user` objects with `first_name`, `role`, `expires_in`. | `LoginRequest`/`SignupRequest` in `app/api/v1/routes/auth.py:26-125` use `username/full_name` and `LoginResponse` only returns `{access_token, token_type, user_id, username}` (no role/expiry). | `app/api/v1/routes/auth.py` | Update docs to describe username-based payloads and the minimal response fields. |
| 2 | Rate limiting is 60/300/1000 *per minute* with `X-RateLimit-*` headers. | `app/core/rate_limiting.py:23-105` configures 100/500/1000 *per hour* (from `settings.PUBLIC_SQL_RATE_LIMIT`) and the handler only emits a `Retry-After` header when available. | `app/core/rate_limiting.py`, `app/config.py:250-284` | Update docs to show hourly quotas and the sole `Retry-After` header. |
| 3 | Error responses include `error_code`, `timestamp`, `correlation_id`. | `ErrorResponse` (`app/api/v1/schemas/common.py:53-74`) returns only `{ "error": str, "correlation_id": str }`. | `app/api/v1/schemas/common.py` | Update docs to match real error body. |
| 4 | Public SQL endpoints return `sql`, `confidence`, `query_id`, `execution_time_ms`. | `sql_public` router (`app/api/v1/routes/sql_public.py:27-126`) uses `SQLResponse`/`ExplanationResponse` which contain only `sql` or `explanation`, `correlation_id`, `status`. | `app/api/v1/routes/sql_public.py`, `app/api/v1/schemas/common.py:18-65` | Update docs to remove non-existent fields from public SQL responses. |
| 5 | Authenticated SQL workflow returns `query_id`, `rag_context_used`, allows history filters (`offset`, `status`). | `SQLGenerationResponse`/`SQLExecutionResponse`/`SQLValidationResponse` in `app/api/v1/schemas/sql.py:18-118` expose `sql`, `confidence`, `intent`, `warnings`, etc., and `GET /api/v1/sql/history` (`app/api/v1/routes/sql.py:161-185`) only accepts `limit`. No `query_id` or filters are returned. | `app/api/v1/routes/sql.py` | Update docs to match actual request/response schemas and available query params. |
| 6 | Feedback submission requires only `query_id`, rating/comment; `/feedback/{id}` returns a single record; `/feedback/train` requires Analyst role. | `FeedbackRequest` (`app/api/v1/schemas/feedback.py:10-41`) requires `question`, and `GET /api/v1/feedback/{query_id}` returns `FeedbackListResponse` (list). The router (`app/api/v1/routes/feedback.py:37-214`) never restricts `/feedback/train` by role—it is available to any authenticated user. | `app/api/v1/routes/feedback.py`, `app/api/v1/schemas/feedback.py` | Update docs to include the `question` field, clarify list response, and remove the Analyst-only statement. |
| 7 | Admin config endpoints (`POST /admin/config`, `POST /admin/approve-sql`, `/admin/scheduled/*`) are functional. | `app/api/v1/routes/admin.py:84-154` returns `AdminFeatureResponse` with `status="planned"` for these routes—they are stubs. | `app/api/v1/routes/admin.py` | Update docs to mark these endpoints as planned stubs instead of implemented features. |
| 8 | `/admin/db/backup` accepts `backup_type` and `include_vector_db`, `/admin/db/backup/list` returns `size_gb`. | `create_backup` (`app/api/v1/routes/db_admin.py:432-460`) takes no body and simply queues `backup_all_systems`. `list_backups` (`app/api/v1/routes/db_admin.py:476-510`) returns `size_bytes` and `size_mb` from file stats. | `app/api/v1/routes/db_admin.py` | Update docs to match the actual signatures and response fields. |
| 9 | `/admin/db/backup/status` and `/admin/db/chroma/status` respond with 202 payloads including `estimated_time` etc. | Both status endpoints just relay Celery `AsyncResult` info: `{task_id, status, progress, message/result}` (`db_admin.py:71-135`, `db_admin.py:452-470`). No ETA fields exist. | `app/api/v1/routes/db_admin.py` | Update docs to drop fields that the API never returns. |

